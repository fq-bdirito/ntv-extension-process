{
    "docs": [
        {
            "location": "/",
            "text": "Overview\n\n\nGOAL: Automate the Global Notice and Extension Processes\n\n\n\n\nGlobal Notice Process\n\n\n\n\nMore Details\n\n\nProcess For Partner types - \nCorporate Housing, Property Direct Furnished, Hotel\n\n\nAuto email goes out to notice contact (client or guest)\n\n\nGuest confirms departure\n\n\nThe following \nReservation\n fields are updated on Salesforce:\n\n\nProvider Notice Given\n checkbox is checked\n\n\nDeparture Confirmed\n checkbox is checked\n\n\nDeparture Confirmed By\n text field captures Guest's signature and date\n\n\nNotice Status\n changes to \nNotice\n\n\nNotice Contact Partner By\n date field captures the date guest confirmed departure\n\n\n\n\n\n\nOnce \nDeparture Confirmed\n checkbox is checked off, an auto email is sent to Partner\n\n\nPartner will confirm guest's departure\n\n\nIf partner does not respond, a reminder email will be sent 32 hrs (8am EST next day) after guest confirmed departure\n\n\nReferences the \nNotice Contact Partner By\n field to determine when guest confirmed departure\n\n\n\n\n\n\nOnce partner has confirmed guest's departure, the following fields are updated in Salesforce:\n\n\nPartner NTV Confirmed\n checkbox is checked off\n\n\nPartner NTV Confirmed By\n text field captures partner's signature and date\n\n\n\n\n\n\nAn auto email is sent to Global Leasing team to notify partner has confirmed guest's departure\n\n\n\n\n\n\nGlobal Extension Process\n\n\n\n\nMore Details\n\n\nProcess For Partner types - \nCorporate Housing, Property Direct Furnished, Hotel\n\n\nAuto email goes out to notice contact (client or guest)\n\n\nGuest requests for an extension via the Client Solutions app\n\n\nOnce the guest submits their request, a new \nExtension Request\n record is created\n\n\nAnd the following fields are updated on Salesforce:\n\n\nRequest\n text field that captures guest's full name and their requested end date\n\n\nStart Date\n date field that is set to their departure date\n\n\nEnd Date\n date field is set to the guest's requested end date\n\n\nOpportunity\n related look up field is populated\n\n\nPrimary Partner Contact\n look up field is set to its associated Reservation's Primary Partner Contact\n\n\n\n\n\n\nUpon creation of a new Extension Request record, an auto email gets sent to partner\n\n\nIf partner does not confirm extension availabilty, a reminder email is sent 24hrs after the extension request record has been created\n\n\nAfter partner confirms extension availability via Client Solutions app the following fields will be updated on Salesforce:\n\n\nPartner Extension Option\n\n\nIs Available\n\n\nRate Change\n\n\nPartner Confirmed New Rate\n\n\n\n\n\n\nPartner Confirmed End Date\n\n\nPartner Extension Confirmed By\n\n\n\n\n\n\nOnce partner signs off, an auto email will be sent to Global Leasing team\n\n\nIf Furnished Quarters approves extension the \nFQ Accept Partner Terms\n checkbox will be checked off\n\n\nAnd an auto email will be sent to the partner to display the detailed information of extension\n\n\nNote: this automated process is only in effect if there is \nno rate change\n\n\nProcess will remain manual for any rate changes.",
            "title": "Home"
        },
        {
            "location": "/#overview",
            "text": "GOAL: Automate the Global Notice and Extension Processes",
            "title": "Overview"
        },
        {
            "location": "/#global-notice-process",
            "text": "More Details  Process For Partner types -  Corporate Housing, Property Direct Furnished, Hotel  Auto email goes out to notice contact (client or guest)  Guest confirms departure  The following  Reservation  fields are updated on Salesforce:  Provider Notice Given  checkbox is checked  Departure Confirmed  checkbox is checked  Departure Confirmed By  text field captures Guest's signature and date  Notice Status  changes to  Notice  Notice Contact Partner By  date field captures the date guest confirmed departure    Once  Departure Confirmed  checkbox is checked off, an auto email is sent to Partner  Partner will confirm guest's departure  If partner does not respond, a reminder email will be sent 32 hrs (8am EST next day) after guest confirmed departure  References the  Notice Contact Partner By  field to determine when guest confirmed departure    Once partner has confirmed guest's departure, the following fields are updated in Salesforce:  Partner NTV Confirmed  checkbox is checked off  Partner NTV Confirmed By  text field captures partner's signature and date    An auto email is sent to Global Leasing team to notify partner has confirmed guest's departure",
            "title": "Global Notice Process"
        },
        {
            "location": "/#global-extension-process",
            "text": "More Details  Process For Partner types -  Corporate Housing, Property Direct Furnished, Hotel  Auto email goes out to notice contact (client or guest)  Guest requests for an extension via the Client Solutions app  Once the guest submits their request, a new  Extension Request  record is created  And the following fields are updated on Salesforce:  Request  text field that captures guest's full name and their requested end date  Start Date  date field that is set to their departure date  End Date  date field is set to the guest's requested end date  Opportunity  related look up field is populated  Primary Partner Contact  look up field is set to its associated Reservation's Primary Partner Contact    Upon creation of a new Extension Request record, an auto email gets sent to partner  If partner does not confirm extension availabilty, a reminder email is sent 24hrs after the extension request record has been created  After partner confirms extension availability via Client Solutions app the following fields will be updated on Salesforce:  Partner Extension Option  Is Available  Rate Change  Partner Confirmed New Rate    Partner Confirmed End Date  Partner Extension Confirmed By    Once partner signs off, an auto email will be sent to Global Leasing team  If Furnished Quarters approves extension the  FQ Accept Partner Terms  checkbox will be checked off  And an auto email will be sent to the partner to display the detailed information of extension  Note: this automated process is only in effect if there is  no rate change  Process will remain manual for any rate changes.",
            "title": "Global Extension Process"
        },
        {
            "location": "/extend/",
            "text": "Global Extension Process\n\n\n\n  Test reservation used for this demo\n  \n\n\n\n\n\n\nGuest Requests Extension\n\n\nGuest receives NTV Email and requests for extension\n\n\n\nA new Extension Request record is created on Salesforce and the following fields are updated:\n\n\n\n\nRequest\n - text field captures guest's full name and requested extension date\n\n\nOpportunity\n - lookup field to its associated Reservation\n\n\nPrimary Partner Contact\n- lookup relates to the reservation's \nPrimary_Partner_Contact__c\n field\n\n\nThis lookup field is needed for workflow rule \nto email\n recepient\n\n\n\n\n\n\nStart Date\n - date field set to current departure date\n\n\nEnd Date\n - date field set to requested date by guest\n\n\n\n\n\n\n\n\nPartner Confirms Extension Availability\n\n\nAs soon as a new Extension Request record is created, an auto email is sent to partner\n\n\n\n\nWorkflow Rule - \nOOM Lease Extension - Partner\n\n\nEmail template - \nOOM Lease Extension - Partner\n\n\n\n\n\n\nThe following fields on Extension Request record are updated in salesforce:\n\n\n\n\nPartner Extension Option\n - picklist that captures partner's selection from Client Solutions app\n\n\nIs Available\n - picklist with values \nYes\n or \nNo\n to confirm availability of extension\n\n\nRate Change\n - picklist with values \nYes\n or \nNo\n to confirm any rate changes\n\n\nPartner Confirmed New Rate\n - currency field captures new rate if there's a rate change, otherwise field remains blank\n\n\nPartner Extension Confirmed By\n - text field captures partner's signature and date\n\n\nPartner Confirmed End Date\n - date field that captures confirmed end date\n\n\nIf date requested by guest is available, \nPartner_Confirmed_End_Date__c\n will be same as \nEnd_Date__c\n\n\nIf date requested by guest is not available, a different date will be set\n\n\n\n\n\n\n\n\n\n\n\n\nFQ Approves Extension\n\n\nWhen extension is confirmed by partner an auto email is sent to Global Leasing team\n\n\n\n\nWorkflow Rule - \nOOM Partner Confirmed Extension\n\n\nEmail Template - \nOOM Partner Confirmed Extension\n\n\n\n\n\n\n\n\nNotify Partner to Update Reservation\n\n\nIf extension proposal from partner is approved the \nFQ Accepts Partner Terms\n checkbox will be checked and an auto email is sent to partner displaying details of extension\n\n\n\n\nWorkflow Rule - \nOOM FQ Approved Extension\n\n\nEmail Template - \nOOM FQ Approved Extension",
            "title": "Extend"
        },
        {
            "location": "/extend/#global-extension-process",
            "text": "Test reservation used for this demo",
            "title": "Global Extension Process"
        },
        {
            "location": "/extend/#guest-requests-extension",
            "text": "Guest receives NTV Email and requests for extension  A new Extension Request record is created on Salesforce and the following fields are updated:   Request  - text field captures guest's full name and requested extension date  Opportunity  - lookup field to its associated Reservation  Primary Partner Contact - lookup relates to the reservation's  Primary_Partner_Contact__c  field  This lookup field is needed for workflow rule  to email  recepient    Start Date  - date field set to current departure date  End Date  - date field set to requested date by guest",
            "title": "Guest Requests Extension"
        },
        {
            "location": "/extend/#partner-confirms-extension-availability",
            "text": "As soon as a new Extension Request record is created, an auto email is sent to partner   Workflow Rule -  OOM Lease Extension - Partner  Email template -  OOM Lease Extension - Partner    The following fields on Extension Request record are updated in salesforce:   Partner Extension Option  - picklist that captures partner's selection from Client Solutions app  Is Available  - picklist with values  Yes  or  No  to confirm availability of extension  Rate Change  - picklist with values  Yes  or  No  to confirm any rate changes  Partner Confirmed New Rate  - currency field captures new rate if there's a rate change, otherwise field remains blank  Partner Extension Confirmed By  - text field captures partner's signature and date  Partner Confirmed End Date  - date field that captures confirmed end date  If date requested by guest is available,  Partner_Confirmed_End_Date__c  will be same as  End_Date__c  If date requested by guest is not available, a different date will be set",
            "title": "Partner Confirms Extension Availability"
        },
        {
            "location": "/extend/#fq-approves-extension",
            "text": "When extension is confirmed by partner an auto email is sent to Global Leasing team   Workflow Rule -  OOM Partner Confirmed Extension  Email Template -  OOM Partner Confirmed Extension",
            "title": "FQ Approves Extension"
        },
        {
            "location": "/extend/#notify-partner-to-update-reservation",
            "text": "If extension proposal from partner is approved the  FQ Accepts Partner Terms  checkbox will be checked and an auto email is sent to partner displaying details of extension   Workflow Rule -  OOM FQ Approved Extension  Email Template -  OOM FQ Approved Extension",
            "title": "Notify Partner to Update Reservation"
        },
        {
            "location": "/notice/",
            "text": "Global Notice Process\n\n\n\n  Test reservation used for this demo\n  \n\n\n\n\n\n\nGuest Confirms Departure\n\n\nGuest receives NTV Email and confirms departure\n\n\n\nAfter guest confirms departure, the following fields on Salesforce Reservation object will be updated:\n\n\n\n\nProvider Notice Given\n - checkbox is checked\n\n\nDeparture Confirmed\n - checkbox is checked\n\n\nDeparture Confirmed By\n - text field captures guest's signature and date\n\n\nNotice Contact Partner By\n - date field is set to the date guest confirmed their departure\n\n\nNotice Status\n - picklist changes to notice\n\n\n\n\n\n\n\n\nPartner Confirms Guest's Departure\n\n\nAn auto email is sent to the reservation's \nPrimary_Partner_Contact__c\n to confirm guest's departure:\n\n\n\n\nWorkflow Rule: \nNTV Partner - Departure Confirmation\n\n\nEmail Template: \nOOM Departure Confirmed - Partner\n\n\n\n\n\n\nIf partner is unable to confirm guest's departure at this time, an option \nUnable to Confirm\nis available which brings up an email template pre-filled to send to \nglobalnotices@furnishedquarters.com\n\n\n\n\nAfter partner confirms guest's departure the following fields will be updated on Reservation object:\n\n\n\n\nPartner NTV Confirmed\n - checkbox is checked\n\n\nPartner NTV Confirmed By\n - text field captures partner's signature and date\n\n\n\n\n\n\n\n\nNotify Global Team when Partner Confirmed Guest's Departure\n\n\nAn auto email is sent to Global Lease team notifying the partner has confirmed guest's departure\n\n\n\n\nWorkflow Rule - \nNTV Provider Notice Confirmed\n\n\nEmail Template - \nProvider Notice Confirmed",
            "title": "Notice"
        },
        {
            "location": "/notice/#global-notice-process",
            "text": "Test reservation used for this demo",
            "title": "Global Notice Process"
        },
        {
            "location": "/notice/#guest-confirms-departure",
            "text": "Guest receives NTV Email and confirms departure  After guest confirms departure, the following fields on Salesforce Reservation object will be updated:   Provider Notice Given  - checkbox is checked  Departure Confirmed  - checkbox is checked  Departure Confirmed By  - text field captures guest's signature and date  Notice Contact Partner By  - date field is set to the date guest confirmed their departure  Notice Status  - picklist changes to notice",
            "title": "Guest Confirms Departure"
        },
        {
            "location": "/notice/#partner-confirms-guests-departure",
            "text": "An auto email is sent to the reservation's  Primary_Partner_Contact__c  to confirm guest's departure:   Workflow Rule:  NTV Partner - Departure Confirmation  Email Template:  OOM Departure Confirmed - Partner    If partner is unable to confirm guest's departure at this time, an option  Unable to Confirm is available which brings up an email template pre-filled to send to  globalnotices@furnishedquarters.com   After partner confirms guest's departure the following fields will be updated on Reservation object:   Partner NTV Confirmed  - checkbox is checked  Partner NTV Confirmed By  - text field captures partner's signature and date",
            "title": "Partner Confirms Guest's Departure"
        },
        {
            "location": "/notice/#notify-global-team-when-partner-confirmed-guests-departure",
            "text": "An auto email is sent to Global Lease team notifying the partner has confirmed guest's departure   Workflow Rule -  NTV Provider Notice Confirmed  Email Template -  Provider Notice Confirmed",
            "title": "Notify Global Team when Partner Confirmed Guest's Departure"
        },
        {
            "location": "/tech/",
            "text": "Tech Guide\n\n\n\n  Test reservation used for this demo\n  \n\n\n\n\n\n\nRoutes\n\n\n./config/routes.rb\n\n\n# Notice Routes\n# departure routes\nget \"/notices/confirm-departure\", to: \"notices#confirmdeparture\"\npost \"/notices/submitconfirmation\", to: \"notices#submitconfirmation\"\nget \"/notices/departure-confirmed\", to: \"notices#departureconfirmed\"\nget \"/notices/departure-confirmation-error\", to: \"notices#departureerror\"\nget \"/notices/partner-confirm-departure\", to: \"notices#partnerconfirmdeparture\"\npost \"/notices/partner-confirms-departure\", to: \"notices#partner_confirms_departure\"\n\n# extension routes\nget \"/notices/extend\", to: \"notices#extend\"\npost \"/notices/submitextension\", to: \"notices#submitextension\"\nget \"/notices/extension-confirmed\", to: \"notices#extensionconfirmed\"\nget \"/notices/extension-error\", to: \"notices#extensionerror\"\nget \"/notices/partner-confirm-extension\", to: \"notices#partnerconfirmextension\"\npost \"/notices/partner-confirms-extension\", to: \"notices#partner_confirms_extension\"\nget \"/notices/confirmation-success\", to: \"notices#confirmationsuccess\" \nget \"/notices/already-confirmed\", to: \"notices#alreadyconfirmed\"\nget \"/notices/fq-confirmation-partner\", to: \"notices#fqconfirmationpartner\"\n\n\n\n\n\n\nHandling Invalid Url\n\n\n\n\nRedirects to \n/notices/404\n page if \nresid\n or \nextid\n is missing or invalid\n\n\nSee \nnotices_controller#is_valid_id\n helper method for validation details\n\n\n\n\n\n\n\n\n\n\nGlobal Notice Process\n\n\n\n\nGuest receives NTV email and confirms departure\n\n\nClicking on \nConfirm Departure\n link will redirect them to \n/notices/confirm-departure\n path\n\n\n\n\n\n\n./app/controllers/notices_controller.rb\n\n\n\nclass NoticesController < ApplicationController\ndef confirmdeparture\n    if is_valid_id(params[:resid]) == false\n        redirect_to \"/notices/404\"\n        return\n    end\n\n    @departure = salesforce.query(\"\n        SELECT Id, Notice_Due__c, RecordTypeId, Departure_Confirmed__c, Departure_Date__c \n        FROM Opportunity \n        WHERE Id = '\"+params[:resid]+\"'\"\n    )\n\n    if @departure.first.nil? \n        redirect_to \"/notices/404\"\n        return\n    end\n\n    @departure.each do |item| \n        if item.Departure_Confirmed__c == true\n            redirect_to handle_path(notices_departure_confirmation_error_path, item.RecordTypeId)\n        end\n    end    \nend\nend\n\n\n\n\n\n\nRenders \n./app/views/notices/confirmdeparture.html.erb\n template\n\n\nChecks if query string params are valid\n\n\nChecks if departure is already confirmed\n\n\nIf record is found, guest will be redirected to \nAlready Confirmed\n page\n\n\nWhen guest submits form, POST request is made to \n/notices/submitconfirmation\n route\n\n\n\n\n\n\n./app/controllers/notices_controller.rb\n\n\nclass NoticesController < ApplicationController\n    # ...\n\n    def submitconfirmation\n        # ...\n            # ...\n            if params[:recordtypeid] == '012300000000Y6vAAE'\n                @confirmdeparture = salesforce.update('Opportunity', \n                    Id: params[:res], \n                    Notice_Contact_Partner_By__c: Time.now.to_date, \n                    Provider_Notice_Given__c: true, \n                    Departure_Confirmed_By__c: confirmed_by(params[:fullname]), \n                    Notice_Status__c: \"Notice\",\n                    ntv_notice__c: 1, \n                    Departure_Confirmed__c: 1\n                )\n            else \n                # ...\n            end\n\n            if @confirmdeparture\n                # Display the success page\n                redirect_to notices_departure_confirmed_path\n            else\n                # If the reservation was already confirmed, display the error page\n                redirect_to handle_path(notices_departure_submission_error_path, params[:recordtypeid])\n            end\n        end\n    end\nend\n\n\n\n\n\n\nIf the reservation's \nRecordTypeId\n is \nOOM - Out of Market\n the above fields will be updated on Salesforce\n\n\nGuest is redirected to \n/notices/departure-confirmed\n path after departure is confirmed\n\n\nIf guest tries to refresh the page or re-submit the form, they will be redirected to \n/notices/departure-confirmation-error\n path\n\n\n\n\n\n\nAn auto email will be sent to the reservation's \nPrimary_Partner_Contact__c\n if the following conditions are met:\n\n\n\n\nPartner_NTV_Confirmed__c\n is false (checkbox is unchecked)\n\n\nDeparture_Confirmed__c\n is true (checkbox is checked)\n\n\nPartner_Type__c\n picklist is either:\n\n\nCorporate Housing\n\n\nHotel\n\n\nProperty Direct Furnished\n\n\n\n\n\n\n\n\n\n\n\n\nWorkflow Rule - \nNTV Provider Notice Confirmed\n\n\nEmail Template - \nProvider Notice Confirmed\n\n\n\n\n\n\nPartner will recieve and email which redirects them to \n/notices/partner-confirm-departure\n path\n\n\n\n./app/controllers/notices_controller.rb\n\n\nclass NoticesController < ApplicationController\n    # ...\n    def partner_confirms_departure\n        # ...\n        if params[:ntvconfirmed] == \"true\" || @reservation.first.Partner_NTV_Confirmed__c == true\n            # ...\n        else\n            if params[:recordtypeid] == '012300000000Y6vAAE'            # of record type OOM\n                @confirmation = salesforce.update('Opportunity', \n                    Id: params[:res], \n                    Partner_NTV_Confirmed__c: true, \n                    Partner_NTV_Confirmed_By__c: confirmed_by(params[:fullname])\n                )\n            end\n\n            if @confirmation \n                redirect_to handle_path(notices_confirmation_success_path, params[:recordtypeid])\n            else \n                redirect_to handle_path(notices_already_confirmed_path, params[:recordtypeid])\n            end\n        end\n    end\nend\n\n\n\n\n\n\nWhen partner submits form, a POST request is made to \n/notices/partner-confirm-departure\n route\n\n\nThe above fields are updated on the Reservation record\n\n\nPartner is redirected to \n/notices/confirmation-success\n path\n\n\nIf partner refreshes the page or tries to re-submit the form they will be redirected to \n/notices/already-confirmed\n path\n\n\n\n\n\n\nWhen \nPartner_NTV_Confirmed__c\n is set to \ntrue\n it will trigger a workflow and sends Global Leasing team an email notifying partner has confirmed guest's departure\n\n\n\n\nWorkflow Rule: \nNTV Partner - Departure Confirmation\n\n\nEmail Template: \nOOM Departure Confirmed - Partner\n\n\n\n\n\n\n\n\nGlobal Extension Process\n\n\nGuest receives NTV email and requests for extension\n\n\n\n\n\nGET request is made to \n/notices/extend\n path\n\n\nWhen guest submits form a POST request is made to \n/notices/submitextension\n path\n\n\n\n\n\n\n./app/controllers/notices_controller.rb\n\n\n# ...\ndef submitextension\n    # ...\n\n    if extension && extension.empty? == false \n        # ...\n    elsif reservation.Departure_Confirmed__c == true \n        # ...\n    elsif params[:monthtomonth] == \" true \"\n        # check if month-to-month is true, meaning an extension may be submitted\n        extension_params = {\n            Opportunity__c: params[:res],\n            Request__c: params[:fullname] + \" requested an extension date of \" + \n                format_date(params[:extensiondate]),\n            Start_Date__c:  params[:departuredate].to_date,\n            End_Date__c: params[:extensiondate].to_date,\n            Primary_Partner_Contact__c: params[:primarypartnerid]\n        }\n\n        # @addnote will be false in the case that extension request was not created. \n        # In this case forward to an error page\n        @addnote = salesforce.create('Extension_Request__c', extension_params)\n\n        if @addnote\n            redirect_to notices_extension_confirmed_path\n        else\n            redirect_to handle_path(notices_extension_submission_error_path, reservation.RecordTypeId)\n        end\n    else\n        redirect_to handle_path(notices_extension_departure_confirmed_path, reservation.RecordTypeId)\n    end\nend\n\n\n\n\n\n\nA new \nExtension_Request__c\n record is created on salesforce, with the above fields updated\n\n\nGuest will be redirected to \n/notices/extension-confirmed\n path\n\n\nIf guest already submitted an extension and tries to re-submit it will redirect guest to \n/notices/extension-error\n path\n\n\nIf guest refreshes the page or clicks on \nI Wish to Extend\n button from NTV email, it will also redirect guest to \n/notices/extension-error\n path\n\n\nNote: the contact email is determined from query string of \noom=true\n using \nglobalnotices@furnishedquarters.com\n for OOM record types.\n\n\nCheck out the \nnotices_controller#handle_path\n helper method for more details\n\n\n\n\n\n\n\n\n\n\nAs soon as a new \nExtension_Request__c\n record is created a workflow rule is triggered and an an auto email is sent to Partner\n\n\n\n\nWorkflow Rule - \nOOM Lease Extension - Partner\n\n\nEmail template - \nOOM Lease Extension - Partner\n\n\n\n\n\n\n\n\n\n\n\n\nPartner can choose from dropdown menu of options to confirm if extension is available\n\n\n\n\nDefault is set to \nExtension Available, Same Rate\n\n\nIf partner chooses either option with \nRate Change\n and/or \nDifferent Date\n\n\nA required input field(s) will appear to capture the new rate and/or new date\n\n\n\n\n\n\n\n\n\n\n\n\nA POST request is made to \n/notices/partner-confirms-extension\n route when partner submits form\n\n\n\n\n\n\n\n\n./app/controllers/notices_controller.rb\n\n\n# ...\ndef partner_confirms_extension\n    # ...\n    if #\n        # checks if url params are valid\n    elsif # ...\n        # checks if extension is already confirmed\n    else \n        extension_params = {\n            Id: params[:extid],\n            Partner_Extension_Option__c: params[:extension],\n            Partner_Extension_Confirmed_By__c: confirmed_by(params[:fullname]),\n            Is_Available__c: 'Yes',\n            Rate_Change__c: 'No',\n            Partner_Confirmed_End_Date__c: @extension.End_Date__c\n        }\n\n        if params[:extension] == \"Extension Available, Same Rate\"\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Rate Change\"\n            extension_params[:Rate_Change__c] = 'Yes'\n            extension_params[:Partner_Confirmed_New_Rate__c] = params[:newrate].to_f\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Different Date\"\n            # date must be formated as yyyy-mm-dd to save to salesforce\n            extension_params[:Partner_Confirmed_End_Date__c] = format_date_sf(params[:newdate])\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Rate Change, Different Date\"\n            extension_params[:Rate_Change__c] = 'Yes'\n            extension_params[:Partner_Confirmed_New_Rate__c] = params[:newrate].to_f\n            extension_params[:Partner_Confirmed_End_Date__c] = format_date_sf(params[:newdate])\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Not Available\"\n            extension_params[:Is_Available__c] = 'No'\n            extension_params[:Rate_Change__c] = nil\n            extension_params[:Partner_Confirmed_End_Date__c] = nil\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        end\n\n        redirect_to handle_path(notices_confirmation_success_path, @extension.Opportunity__r.RecordTypeId)\n    end\nend\n\n\n\n\n\n\nThe Extension Request record fields will be updated depending on which option Partner chooses\n\n\nPartner will be redirected to \n/notices/confirmation-success\n path after confirming extension availability\n\n\nIf partner tries to refresh the page or re-submit the form, they will be redirected to \n/notices/already-confirmed\n path\n\n\n\n\n\n\nOnce \nPartner_Extension_Confirmed_By__c\n field is captured, a workflow will be triggered and an auto email will be sent to Global Leasing team to either accept or reject partner terms\n\n\n\n\nWorkflow Rule - \nOOM Partner Confirmed Extension\n\n\nEmail Template - \nOOM Partner Confirmed Extension\n\n\n\n\n\n\n\n\nIf Partner terms are accepted, the \nFQ_Accepts_Partner_Terms__c\n checkbox is checked off in Salesforce and an auto email is sent to partner displaying the details of extension request\n\n\n\n\nWorkflow Rule - \nOOM FQ Approved Extension\n\n\nEmail Template - \nOOM FQ Approved Extension\n\n\n\n\n\n\n\n\nPartner is redirected to \n/notices/fq-confirmation-partner\n route",
            "title": "Tech"
        },
        {
            "location": "/tech/#tech-guide",
            "text": "Test reservation used for this demo",
            "title": "Tech Guide"
        },
        {
            "location": "/tech/#routes",
            "text": "",
            "title": "Routes"
        },
        {
            "location": "/tech/#configroutesrb",
            "text": "# Notice Routes\n# departure routes\nget \"/notices/confirm-departure\", to: \"notices#confirmdeparture\"\npost \"/notices/submitconfirmation\", to: \"notices#submitconfirmation\"\nget \"/notices/departure-confirmed\", to: \"notices#departureconfirmed\"\nget \"/notices/departure-confirmation-error\", to: \"notices#departureerror\"\nget \"/notices/partner-confirm-departure\", to: \"notices#partnerconfirmdeparture\"\npost \"/notices/partner-confirms-departure\", to: \"notices#partner_confirms_departure\"\n\n# extension routes\nget \"/notices/extend\", to: \"notices#extend\"\npost \"/notices/submitextension\", to: \"notices#submitextension\"\nget \"/notices/extension-confirmed\", to: \"notices#extensionconfirmed\"\nget \"/notices/extension-error\", to: \"notices#extensionerror\"\nget \"/notices/partner-confirm-extension\", to: \"notices#partnerconfirmextension\"\npost \"/notices/partner-confirms-extension\", to: \"notices#partner_confirms_extension\"\nget \"/notices/confirmation-success\", to: \"notices#confirmationsuccess\" \nget \"/notices/already-confirmed\", to: \"notices#alreadyconfirmed\"\nget \"/notices/fq-confirmation-partner\", to: \"notices#fqconfirmationpartner\"",
            "title": "./config/routes.rb"
        },
        {
            "location": "/tech/#handling-invalid-url",
            "text": "Redirects to  /notices/404  page if  resid  or  extid  is missing or invalid  See  notices_controller#is_valid_id  helper method for validation details",
            "title": "Handling Invalid Url"
        },
        {
            "location": "/tech/#global-notice-process",
            "text": "Guest receives NTV email and confirms departure  Clicking on  Confirm Departure  link will redirect them to  /notices/confirm-departure  path",
            "title": "Global Notice Process"
        },
        {
            "location": "/tech/#appcontrollersnotices_controllerrb",
            "text": "class NoticesController < ApplicationController\ndef confirmdeparture\n    if is_valid_id(params[:resid]) == false\n        redirect_to \"/notices/404\"\n        return\n    end\n\n    @departure = salesforce.query(\"\n        SELECT Id, Notice_Due__c, RecordTypeId, Departure_Confirmed__c, Departure_Date__c \n        FROM Opportunity \n        WHERE Id = '\"+params[:resid]+\"'\"\n    )\n\n    if @departure.first.nil? \n        redirect_to \"/notices/404\"\n        return\n    end\n\n    @departure.each do |item| \n        if item.Departure_Confirmed__c == true\n            redirect_to handle_path(notices_departure_confirmation_error_path, item.RecordTypeId)\n        end\n    end    \nend\nend   Renders  ./app/views/notices/confirmdeparture.html.erb  template  Checks if query string params are valid  Checks if departure is already confirmed  If record is found, guest will be redirected to  Already Confirmed  page  When guest submits form, POST request is made to  /notices/submitconfirmation  route",
            "title": "./app/controllers/notices_controller.rb"
        },
        {
            "location": "/tech/#appcontrollersnotices_controllerrb_1",
            "text": "class NoticesController < ApplicationController\n    # ...\n\n    def submitconfirmation\n        # ...\n            # ...\n            if params[:recordtypeid] == '012300000000Y6vAAE'\n                @confirmdeparture = salesforce.update('Opportunity', \n                    Id: params[:res], \n                    Notice_Contact_Partner_By__c: Time.now.to_date, \n                    Provider_Notice_Given__c: true, \n                    Departure_Confirmed_By__c: confirmed_by(params[:fullname]), \n                    Notice_Status__c: \"Notice\",\n                    ntv_notice__c: 1, \n                    Departure_Confirmed__c: 1\n                )\n            else \n                # ...\n            end\n\n            if @confirmdeparture\n                # Display the success page\n                redirect_to notices_departure_confirmed_path\n            else\n                # If the reservation was already confirmed, display the error page\n                redirect_to handle_path(notices_departure_submission_error_path, params[:recordtypeid])\n            end\n        end\n    end\nend   If the reservation's  RecordTypeId  is  OOM - Out of Market  the above fields will be updated on Salesforce  Guest is redirected to  /notices/departure-confirmed  path after departure is confirmed  If guest tries to refresh the page or re-submit the form, they will be redirected to  /notices/departure-confirmation-error  path    An auto email will be sent to the reservation's  Primary_Partner_Contact__c  if the following conditions are met:   Partner_NTV_Confirmed__c  is false (checkbox is unchecked)  Departure_Confirmed__c  is true (checkbox is checked)  Partner_Type__c  picklist is either:  Corporate Housing  Hotel  Property Direct Furnished       Workflow Rule -  NTV Provider Notice Confirmed  Email Template -  Provider Notice Confirmed    Partner will recieve and email which redirects them to  /notices/partner-confirm-departure  path",
            "title": "./app/controllers/notices_controller.rb"
        },
        {
            "location": "/tech/#appcontrollersnotices_controllerrb_2",
            "text": "class NoticesController < ApplicationController\n    # ...\n    def partner_confirms_departure\n        # ...\n        if params[:ntvconfirmed] == \"true\" || @reservation.first.Partner_NTV_Confirmed__c == true\n            # ...\n        else\n            if params[:recordtypeid] == '012300000000Y6vAAE'            # of record type OOM\n                @confirmation = salesforce.update('Opportunity', \n                    Id: params[:res], \n                    Partner_NTV_Confirmed__c: true, \n                    Partner_NTV_Confirmed_By__c: confirmed_by(params[:fullname])\n                )\n            end\n\n            if @confirmation \n                redirect_to handle_path(notices_confirmation_success_path, params[:recordtypeid])\n            else \n                redirect_to handle_path(notices_already_confirmed_path, params[:recordtypeid])\n            end\n        end\n    end\nend   When partner submits form, a POST request is made to  /notices/partner-confirm-departure  route  The above fields are updated on the Reservation record  Partner is redirected to  /notices/confirmation-success  path  If partner refreshes the page or tries to re-submit the form they will be redirected to  /notices/already-confirmed  path    When  Partner_NTV_Confirmed__c  is set to  true  it will trigger a workflow and sends Global Leasing team an email notifying partner has confirmed guest's departure   Workflow Rule:  NTV Partner - Departure Confirmation  Email Template:  OOM Departure Confirmed - Partner",
            "title": "./app/controllers/notices_controller.rb"
        },
        {
            "location": "/tech/#global-extension-process",
            "text": "Guest receives NTV email and requests for extension   GET request is made to  /notices/extend  path  When guest submits form a POST request is made to  /notices/submitextension  path",
            "title": "Global Extension Process"
        },
        {
            "location": "/tech/#appcontrollersnotices_controllerrb_3",
            "text": "# ...\ndef submitextension\n    # ...\n\n    if extension && extension.empty? == false \n        # ...\n    elsif reservation.Departure_Confirmed__c == true \n        # ...\n    elsif params[:monthtomonth] == \" true \"\n        # check if month-to-month is true, meaning an extension may be submitted\n        extension_params = {\n            Opportunity__c: params[:res],\n            Request__c: params[:fullname] + \" requested an extension date of \" + \n                format_date(params[:extensiondate]),\n            Start_Date__c:  params[:departuredate].to_date,\n            End_Date__c: params[:extensiondate].to_date,\n            Primary_Partner_Contact__c: params[:primarypartnerid]\n        }\n\n        # @addnote will be false in the case that extension request was not created. \n        # In this case forward to an error page\n        @addnote = salesforce.create('Extension_Request__c', extension_params)\n\n        if @addnote\n            redirect_to notices_extension_confirmed_path\n        else\n            redirect_to handle_path(notices_extension_submission_error_path, reservation.RecordTypeId)\n        end\n    else\n        redirect_to handle_path(notices_extension_departure_confirmed_path, reservation.RecordTypeId)\n    end\nend   A new  Extension_Request__c  record is created on salesforce, with the above fields updated  Guest will be redirected to  /notices/extension-confirmed  path  If guest already submitted an extension and tries to re-submit it will redirect guest to  /notices/extension-error  path  If guest refreshes the page or clicks on  I Wish to Extend  button from NTV email, it will also redirect guest to  /notices/extension-error  path  Note: the contact email is determined from query string of  oom=true  using  globalnotices@furnishedquarters.com  for OOM record types.  Check out the  notices_controller#handle_path  helper method for more details      As soon as a new  Extension_Request__c  record is created a workflow rule is triggered and an an auto email is sent to Partner   Workflow Rule -  OOM Lease Extension - Partner  Email template -  OOM Lease Extension - Partner       Partner can choose from dropdown menu of options to confirm if extension is available   Default is set to  Extension Available, Same Rate  If partner chooses either option with  Rate Change  and/or  Different Date  A required input field(s) will appear to capture the new rate and/or new date       A POST request is made to  /notices/partner-confirms-extension  route when partner submits form",
            "title": "./app/controllers/notices_controller.rb"
        },
        {
            "location": "/tech/#appcontrollersnotices_controllerrb_4",
            "text": "# ...\ndef partner_confirms_extension\n    # ...\n    if #\n        # checks if url params are valid\n    elsif # ...\n        # checks if extension is already confirmed\n    else \n        extension_params = {\n            Id: params[:extid],\n            Partner_Extension_Option__c: params[:extension],\n            Partner_Extension_Confirmed_By__c: confirmed_by(params[:fullname]),\n            Is_Available__c: 'Yes',\n            Rate_Change__c: 'No',\n            Partner_Confirmed_End_Date__c: @extension.End_Date__c\n        }\n\n        if params[:extension] == \"Extension Available, Same Rate\"\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Rate Change\"\n            extension_params[:Rate_Change__c] = 'Yes'\n            extension_params[:Partner_Confirmed_New_Rate__c] = params[:newrate].to_f\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Different Date\"\n            # date must be formated as yyyy-mm-dd to save to salesforce\n            extension_params[:Partner_Confirmed_End_Date__c] = format_date_sf(params[:newdate])\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Available, Rate Change, Different Date\"\n            extension_params[:Rate_Change__c] = 'Yes'\n            extension_params[:Partner_Confirmed_New_Rate__c] = params[:newrate].to_f\n            extension_params[:Partner_Confirmed_End_Date__c] = format_date_sf(params[:newdate])\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        elsif params[:extension] == \"Extension Not Available\"\n            extension_params[:Is_Available__c] = 'No'\n            extension_params[:Rate_Change__c] = nil\n            extension_params[:Partner_Confirmed_End_Date__c] = nil\n            @request = salesforce.update('Extension_Request__c', extension_params)\n        end\n\n        redirect_to handle_path(notices_confirmation_success_path, @extension.Opportunity__r.RecordTypeId)\n    end\nend   The Extension Request record fields will be updated depending on which option Partner chooses  Partner will be redirected to  /notices/confirmation-success  path after confirming extension availability  If partner tries to refresh the page or re-submit the form, they will be redirected to  /notices/already-confirmed  path    Once  Partner_Extension_Confirmed_By__c  field is captured, a workflow will be triggered and an auto email will be sent to Global Leasing team to either accept or reject partner terms   Workflow Rule -  OOM Partner Confirmed Extension  Email Template -  OOM Partner Confirmed Extension     If Partner terms are accepted, the  FQ_Accepts_Partner_Terms__c  checkbox is checked off in Salesforce and an auto email is sent to partner displaying the details of extension request   Workflow Rule -  OOM FQ Approved Extension  Email Template -  OOM FQ Approved Extension     Partner is redirected to  /notices/fq-confirmation-partner  route",
            "title": "./app/controllers/notices_controller.rb"
        }
    ]
}